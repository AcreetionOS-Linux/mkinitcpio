#!/bin/bash

build() {
    find "$BUILDROOT" -type f -perm -u+w -print0 2>/dev/null | while read -d '' bin; do
        case $(LC_ALL=C readelf -h "$bin" 2>/dev/null) in
            *Type:*'DYN '*)
                # Libraries (.so)
                strip --strip-unneeded "$bin"
                ;;
            *Type:*'REL '*)
                # Libraries (.a)
                strip --strip-debug "$bin"
                ;;
            *Type:*'EXEC '*)
                # Binaries
                strip --strip-all "$bin"
                ;;
        esac
    done
}

help() {
    cat <<HELPEOF
This hook will locate and strip binaries on your image before archival and
compression. This hook should be last, as any binaries added to the image after
this hook runs will not be stripped. This is mostly useful for users who run
local debug builds but whom do not want or need the extra weight of debug
symbols on their image.
HELPEOF
}

# vim: set ft=sh ts=4 sw=4 et:
