#!/bin/bash

args=('-p')

while read -r line; do
    if [[ $line = usr/lib/modules/+([^/])/pkgbase ]]; then
        mapfile -O ${#targets[@]} -t targets < "/$line"
    else
        args=('-P') # all presets
        break
    fi
done

mkinitcpio "${args[@]}" "${targets[@]}"
